#<?cfg paf policy ?>
#
# Orchestration Layer Policy for a DC3 production
#
# Copy this file and modify as needed.
#
shortName:           DataRelease
# eventBrokerHost:     lsst11.ncsa.illinois.edu
eventBrokerHost:     lsst8.ncsa.uiuc.edu
repositoryDirectory: ./pipeline
productionShutdownTopic:       productionShutdown

# if a special productionRunConfigurator class is needed, specify it
# here; otherwise, the default will be instantiated
# configurationClass:  lsst.ctrl.orca.BasicProductionRunConfigurator
#
# if there is special configuration information associated with the 
# the class, it will go in here:
# configuration: {
# 
# }

# this is production-level database configuration.  Note that there can 
# be multiple database occurances.  The WorkflowConfigurator will create a
# DatabaseConfigurator for each entry.  Each must also be copied into the 
# pipeline config file.
# 
database: {

    name: dc3bGlobal

    system: {   
        authInfo: {
            host: lsst10.ncsa.uiuc.edu
            port: 3306
        }

        runCleanup: {
            daysFirstNotice: 7  # days when first notice is sent before run can be deleted
            daysFinalNotice: 1  # days when final notice is sent before run can be deleted
        }
    }

    configurationClass: lsst.ctrl.orca.db.DC3Configurator
    configuration: {  
        globalDbName: GlobalDB
        dcVersion: PT1_2
        dcDbName: DC3b_DB
        minPercDiskSpaceReq: 10   # measured in percentages
        userRunLife: 2            # measured in weeks
    }

   logger: {
       launch: true
   }

}

workflow: {
    shortName: PT1Workflow
    platform:  @platform/imsim-lsstcluster-weekly.paf
    shutdownTopic:       workflowShutdown

    configurationClass: lsst.ctrl.orca.GenericPipelineWorkflowConfigurator
    configuration: {
        # script creates symlinks to datar;  is called by orca:
        #    <script> <runid> <dataRepository> <collection>
        deployData: {
            # dataRepository: /cfs/projects/lsst/DC3/data/obs/imsimdata
            # Weekly's Stars and Galaxies dataset
            # dataRepository: /lsst3/weekly/data/obs
            # Weekly's Stars only dataset
            dataRepository: /lsst3/weekly/data/obs_imSim-2011-05-25
            collection: PT1.2
            script: "$DATAREL_DIR/bin/runOrca/deployData.sh"
        }
        # launchScript: 

        announceData: {
            script: $CTRL_SCHED_DIR/bin/announceDataset.py
            # topic: RawAvailable
            topic: RawCcdAvailable
            # inputdata: /lsst3/weekly/pipeline/weekly.input
            inputdata: ./weekly.input
        }
    }

    pipeline: {
       shortName:     joboffices
       # definition:    @imsim-joboffice-abe.paf
       definition:    @joboffice.paf
       runCount: 1
       deploy: {
          # the schema for this node is determined by the above 
          # configuration class.  In this case, we run on the first
          # slot the pipeline is assigned, since the nodes can not
          # be determined in advance.
          processesOnNode: lsst8:1
       }
       launch: true
    }
    ### pipeline: {
    ###   shortName:     isr
    ###   definition:    @imsim-isr-master-abe.paf
    ###   runCount: 5
    ###   deploy: {
          # the schema for this node is determined by the above 
          # configuration class.  In this case, we run on the first
          # slot the pipeline is assigned, since the nodes can not
          # be determined in advance.
    ###   }
    ###   launch: true
    ###}

    pipeline: {
       shortName:     PT1PipeA
       definition:    @main-ImSim.paf
       runCount: 2     
       deploy: {
          processesOnNode: lsst5:2
       }
       launch: true
    }

    pipeline: {
       shortName:     PT1PipeB
       definition:    @main-ImSim.paf
       runCount: 3     
       deploy: {
          processesOnNode: lsst11.ncsa.illinois.edu:3
       }
       launch: true
    }

    # pipeline: {
    #    shortName:     PT1PipeC
    #    definition:    @main-ImSim.paf
    #    runCount: 5     
    #   deploy: {
    #      processesOnNode: lsst11.ncsa.illinois.edu:5
    ##     # processesOnNode: lsst6:4 # processesOnNode: lsst7:5 # processesOnNode: lsst8:4 # processesOnNode: lsst9:5
    #   }
    #   launch: true
    #}



    # pipeline: {
    #   shortName:     ccdassembly
    #   definition:    @imsim-ca-master.paf
    #   runCount: 3
    #   deploy: {
    #   }
    #   launch: true
    # }
    # pipeline: {
    #    shortName:     crsplit
    #   definition:    @imsim-crSplit-master.paf
    #   runCount: 2
    #   deploy: {
    #   }
    #   launch: true
    # }
    # pipeline: {
    #   shortName:     imgchar
    #   definition:    @imsim-imgChar-master.paf
    #   runCount: 4
    #   deploy: {
    #   }
    #   launch: true
    # }
    # pipeline: {
    #   shortName:     sfm
    #   definition:    @imsim-sfm-master.paf
    #    runCount: 4
    #    deploy: {
    #   }
    #    launch: true
    # }
}
